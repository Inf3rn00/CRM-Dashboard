name: Deploy to Local Hyper-V

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    # 1. This tells GitHub: "Send this job to my local CentOS VM"
    runs-on: self-hosted

    steps:
    # 2. Download the code onto the VM
    - name: Checkout Code
      uses: actions/checkout@v2

    # 3. Run commands DIRECTLY (No SSH needed anymore!)
    - name: Build and Run
      run: |
        echo "üöÄ I am running inside your local CentOS VM!"
        
        # Navigate to the folder where the runner downloaded the code
        # (The runner automatically puts us in the right folder)
        
        # Run Docker commands directly
        # Note: Since you ran the runner as Root, we don't strictly need sudo, 
        # but it's safe to keep it.
        
        if [ -f "docker-compose.yml" ]; then
          docker compose down
          docker compose up -d --build
          docker system prune -f
          echo "‚úÖ Deployment Successful!"
        else
          echo "‚ö†Ô∏è Error: docker-compose.yml not found in $(pwd)"
          ls -la
          exit 1
        fi